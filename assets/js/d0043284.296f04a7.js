"use strict";(self.webpackChunkcmta_reviewer=self.webpackChunkcmta_reviewer||[]).push([[5172],{8050:(e,t,i)=>{i.r(t),i.d(t,{default:()=>c});var a=i(6540),s=i(839),n=i(3962),r=i(8185),o=i(6614),l=i(4848);function c(){const[e,t]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(null),[m,g]=(0,a.useState)("premium");(0,a.useEffect)(()=>{const e=new URLSearchParams(window.location.search);g(e.get("tier")||"premium")},[]),(0,a.useEffect)(()=>{const e=(0,n.getAuth)();(0,n.onAuthStateChanged)(e,e=>{t(e),e&&f(e.uid)})},[]);const f=async e=>{const t=(await(0,r.getDocs)((0,r.collection)(o.db,"payments"))).docs.map(e=>({id:e.id,...e.data()})).filter(t=>t.uid===e&&t.tier===m).sort((e,t)=>(t.createdAt?.seconds||0)-(e.createdAt?.seconds||0));h(t[0]||null)};return(0,l.jsx)(s.A,{title:"Payment",children:(0,l.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:e?(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{children:["Upgrade to ",m]}),p?(0,l.jsxs)("div",{style:{marginBottom:"1rem",color:"green"},children:["\u2705 You already uploaded a receipt on"," ",new Date(1e3*p.createdAt.seconds).toLocaleString(),". Please wait 24hrs for verification."]}):(0,l.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),i&&e)try{u(!0);const t=new FileReader;t.readAsDataURL(i),t.onload=async()=>{await(0,r.gS)((0,r.collection)(o.db,"payments"),{uid:e.uid,email:e.email,tier:m,receiptBase64:t.result,fileName:i.name,fileSize:i.size,fileType:i.type,status:"pending",createdAt:(0,r.O5)()}),u(!1),c(null),f(e.uid),alert("\u2705 Receipt uploaded!")}}catch(a){console.error(a),u(!1),alert("\u274c Upload failed.")}},children:[(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>c(e.target.files[0]),required:!0}),(0,l.jsx)("button",{type:"submit",disabled:d,style:{marginTop:"10px"},children:d?"Uploading...":"Upload Receipt"})]}),(0,l.jsxs)("p",{style:{marginTop:"1rem"},children:["If upload fails, you can send your receipt to ",(0,l.jsx)("a",{href:"mailto:support@phcustomsscholar.com",children:"support@phcustomsscholar.com"})]})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"\ud83d\udd12 Please log in with Google"}),(0,l.jsx)("button",{onClick:async()=>{const e=(0,n.getAuth)(),t=new n.GoogleAuthProvider;await(0,n.signInWithPopup)(e,t)},children:"Login with Google"})]})})})}}}]);